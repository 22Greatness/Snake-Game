<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ultimate Snake Game V4.0</title>
  <style>
    * { box-sizing: border-box; }
    html, body {
      margin: 0;
      height: 100%;
      overflow: hidden;
      background: #000;
      font-family: Arial, sans-serif;
      color: white;
    }
    canvas {
      display: block;
      margin: 0 auto;
      background: #111;
    }
    #ui {
      position: absolute;
      bottom: 12px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .row {
      display: flex;
      gap: 6px;
      margin: 4px;
    }
    button {
      padding: 12px;
      background: #222;
      border: none;
      border-radius: 6px;
      color: white;
      font-size: 18px;
    }
    #info {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.5);
      padding: 8px;
      border-radius: 5px;
    }
    #achievements {
      position: absolute;
      bottom: 10px;
      left: 10px;
      font-size: 14px;
      color: #ccc;
    }
  </style>
</head>
<body>
  <canvas id="game" width="600" height="400"></canvas>
  <div id="info">
    <div>Score: <span id="score">0</span></div>
    <div>Best: <span id="best">0</span></div>
    <div>Time: <span id="time">0s</span></div>
    <div>User: <span id="username"></span></div>
  </div>
  <div id="achievements"><strong>Achievements:</strong><div id="achieve-list"></div></div>
  <div id="ui">
    <div class="row">
      <button onclick="setDir('up')">&#8679;</button>
    </div>
    <div class="row">
      <button onclick="setDir('left')">&#8678;</button>
      <button onclick="setDir('right')">&#8680;</button>
    </div>
    <div class="row">
      <button onclick="setDir('down')">&#8681;</button>
    </div>
    <div class="row">
      <button onclick="pauseGame()">Pause</button>
      <button onclick="restartGame()">Restart</button>
    </div>
  </div>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const scoreEl = document.getElementById("score");
    const bestEl = document.getElementById("best");
    const timeEl = document.getElementById("time");
    const userEl = document.getElementById("username");
    const achievements = document.getElementById("achieve-list");

    let box = 20, dir = "right", gameLoop, snake, food, bombs, score, timer = 0, interval = 150, paused = false;
    let username = prompt("Enter your username:", "Player");
    let mode = prompt("Mode: solo or ai?", "solo");
    let skin = prompt("Snake color? (green/blue/red)", "green");
    userEl.textContent = username;

    let best = localStorage.getItem("best") || 0;
    bestEl.textContent = best;

    function initGame() {
      snake = [{x: 5, y: 5}];
      food = spawn();
      bombs = [spawn(), spawn()];
      score = 0;
      dir = "right";
      interval = 150;
      timer = 0;
      clearInterval(gameLoop);
      gameLoop = setInterval(update, interval);
    }

    function spawn() {
      return {
        x: Math.floor(Math.random()*canvas.width/box),
        y: Math.floor(Math.random()*canvas.height/box)
      };
    }

    function setDir(d) {
      if ((d === "left" && dir !== "right") || (d === "right" && dir !== "left") ||
          (d === "up" && dir !== "down") || (d === "down" && dir !== "up")) {
        dir = d;
      }
    }

    function pauseGame() {
      paused = !paused;
    }

    function restartGame() {
      initGame();
    }

    function update() {
      if (paused) return;
      timer++;
      timeEl.textContent = timer + "s";

      const head = {...snake[0]};
      if (dir === "left") head.x--;
      if (dir === "right") head.x++;
      if (dir === "up") head.y--;
      if (dir === "down") head.y++;

      if (head.x < 0 || head.y < 0 || head.x >= canvas.width/box || head.y >= canvas.height/box || snake.some(s => s.x === head.x && s.y === head.y)) {
        alert("Game Over");
        if (score > best) localStorage.setItem("best", score);
        return initGame();
      }

      if (head.x === food.x && head.y === food.y) {
        food = spawn();
        score++;
        interval = Math.max(50, interval - 2);
        clearInterval(gameLoop);
        gameLoop = setInterval(update, interval);
      } else {
        snake.pop();
      }

      for (let b of bombs) {
        if (head.x === b.x && head.y === b.y) {
          alert("Boom! Game Over");
          if (score > best) localStorage.setItem("best", score);
          return initGame();
        }
      }

      snake.unshift(head);
      draw();
    }

    function draw() {
      ctx.fillStyle = "#000";
      ctx.fillRect(0,0,canvas.width,canvas.height);

      ctx.fillStyle = skin;
      for (let s of snake) {
        ctx.fillRect(s.x*box, s.y*box, box-1, box-1);
      }

      ctx.fillStyle = "red";
      ctx.fillRect(food.x*box, food.y*box, box-1, box-1);

      for (let b of bombs) {
        ctx.beginPath();
        ctx.arc(b.x*box + box/2, b.y*box + box/2, box/2 - 2, 0, 2*Math.PI);
        ctx.fillStyle = "purple";
        ctx.fill();
        ctx.beginPath();
        ctx.arc(b.x*box + box/2, b.y*box + box/2 - 5, 2, 0, 2*Math.PI);
        ctx.fillStyle = "orange";
        ctx.fill();
      }

      scoreEl.textContent = score;
    }

    // Touch support
    let touchStartX, touchStartY;
    canvas.addEventListener('touchstart', e => {
      const touch = e.touches[0];
      touchStartX = touch.clientX;
      touchStartY = touch.clientY;
    });
    canvas.addEventListener('touchend', e => {
      const dx = e.changedTouches[0].clientX - touchStartX;
      const dy = e.changedTouches[0].clientY - touchStartY;
      if (Math.abs(dx) > Math.abs(dy)) setDir(dx > 0 ? 'right' : 'left');
      else setDir(dy > 0 ? 'down' : 'up');
    });

    initGame();
  </script>
</body>
</html>
